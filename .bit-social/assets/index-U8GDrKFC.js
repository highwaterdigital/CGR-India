import{a1 as X,x as q,y as V,z,ag as Y,ah as Z,a4 as B,r as v,G as E,H as Q,K as ee,D as a,B as g,F as j,j as s,S as I,E as A,ai as te,Q as ae,aj as se,T as J,ak as oe,N as le,al as re,am as ce,an as N}from"./main-dark-cougars-deny.js";import{C as ie}from"./CronWarning-DFKHCBiE.js";import{D as ne,R as he}from"./Refresh-FDMSooVn.js";import{u as ue}from"./useSchedules-B6_EM5mm.js";import{F as L,P as de}from"./index-CPtrnYXw.js";import{D as ge}from"./index-C6ul2ShU.js";import{S as O}from"./index-DBPaF3NB.js";import{T as x}from"./index-CrQNWDfa.js";import{s as pe}from"./index-CWrjzGU5.js";import{F as K}from"./index-k0aiACIX.js";import{F as me}from"./Table-Bk7NZwbz.js";import{A as fe}from"./index-SKRzeqqf.js";import"./AntIconWrapper-3WczuWaa.js";import"./collapse-BbEVqHco.js";import"./row-lqfnAFmz.js";import"./mediaQueryUtil-BSyvLspT.js";import"./index-DLKty1T3.js";import"./EllipsisOutlined-BGoHQ3ZR.js";import"./move-BztwN_76.js";import"./Input-DHLpvPkV.js";import"./context-BFZyzWOC.js";import"./addEventListener-soaqs0Nt.js";import"./index-BIt_DxpP.js";import"./index-C_dICaWn.js";import"./index-BuYuExV9.js";import"./index-CZAKQmtW.js";import"./LeftOutlined-BlD6DJ6Y.js";import"./Dropdown-DlXLC9YR.js";import"./index-XEZ_xjnA.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G={date:"all",platform:"all",schedule:"all",scheduleId:"all",status:"all"},R=globalThis.jotaiAtomCache.get("/home/runner/work/bit-social/bit-social/frontend/src/common/globalStates/$logFilter.ts/$logFilter",X(G));R.debugLabel="$logFilter";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function be(e,t){const i=q(),{isPending:c,mutateAsync:l}=V({mutationFn:async r=>z("logs/destroy/batch",{logIds:r},void 0,"POST"),onSuccess:()=>{i.invalidateQueries({queryKey:["logs",[t,e]]})}});return{deleteLogs:r=>l(r),isLogsDeleting:c}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ye(e,t,i){const{data:c,isFetched:l,isFetching:r,isLoading:n,refetch:h}=Y({enabled:!0,placeholderData:Z,queryFn:async()=>z(`logs/${e}/${t}`,void 0,{...i},"GET"),queryKey:["logs",[e,t]],refetchInterval:3e3}),{current_page:f,current_total:u,data:T,pages:b,per_page:C,total:P}=(c==null?void 0:c.data)||{};return{currentPage:f,currentTotal:u,isFetched:l,isFetching:r,isLogsLoading:n,logData:T||[],perPage:C,refetch:h,totalLogs:P,totalPages:b}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ce(){const e=q(),{data:t,isPending:i,mutateAsync:c}=V({mutationFn:async l=>z("retry",{...l},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["logs"]})}});return{isRetryLoading:i,result:t,retry:l=>c(l)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Se(){const[e,t]=B(R),[i,c]=v.useState(!1),[,l]=E({}),[r,n]=v.useState(),{schedules:h}=ue(),{isProClient:f}=Q(ee),u=()=>{c(!0)},T=()=>{t(e),c(!1)},b=(d,F)=>{t(m=>({...m,[d]:F})),l(m=>(m.set("page","1"),m))},C=[{label:a("All"),value:"all"},{label:a("Facebook"),value:"facebook"},{label:a("Linkedin"),value:"linkedin"}],P=[{label:a("Google Business Profile"),value:"googleBusinessProfile"},{label:a("Pinterest"),value:"pinterest"},{label:a("Discord"),value:"discord"},{label:a("Tumblr"),value:"tumblr"},{label:a("X (twitter)"),value:"twitter"},{label:a("Instagram"),value:"instagram"},{label:a("Threads"),value:"threads"}],w=f?[...C,...P]:C,k=h==null?void 0:h.map(d=>({label:d.name,value:String(d.id)})),y=[{label:a("All"),value:"all"},...k],M=d=>(F,m)=>{if(Array.isArray(m)&&m.every(_=>_===""))return b(d,"all");n(F),b(d,JSON.stringify(m))},D=()=>{n(void 0),t(G)};return g(j,{children:[s(I,{children:s(A,{icon:s(te,{size:12}),onClick:u,size:"large",children:a("Filter")})}),s(ae,{footer:[s(A,{onClick:D,type:"primary",children:a("Reset")},"reset")],onCancel:T,open:i,title:a("Logs filter"),width:600,children:g(L,{layout:"vertical",children:[s(L.Item,{label:a("Date"),children:s(ge.RangePicker,{className:"w-100",onChange:M("date"),value:r})}),s(L.Item,{label:a("Status"),children:s(O,{defaultValue:"all",onChange:d=>b("status",d),options:[{label:a("All"),value:"all"},{label:a("Success"),value:"1"},{label:a("Error"),value:"0"}],value:e.status})}),s(L.Item,{label:a("Schedule"),children:s(O,{defaultValue:"all",onChange:d=>b("schedule",d),options:y,value:e.schedule})}),s(L.Item,{label:a("Platform"),children:s(O,{defaultValue:"all",onChange:d=>b("platform",d),options:w,value:e.platform})})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $={0:"error",1:"success"};function Ae(){const[e,t]=B(R),[,i]=E({}),{platform:c,schedule:l,status:r}=e,n=e.date==="all"?!1:JSON.parse(e.date),h=f=>{t(u=>({...u,[f]:"all"})),i(u=>(u.set("page","1"),u))};return g(I,{size:"small",children:[a("Filter:"),n&&g(x,{closable:!0,color:"purple",onClose:()=>h("date"),children:[a("Date"),": ",n[0]," ",a("to")," ",n[1]]}),r!=="all"&&g(x,{closeIcon:!0,color:$[r],onClose:()=>h("status"),children:[a("Status"),": ",$[r]]}),l!=="all"&&g(x,{closable:!0,color:"orange",onClose:()=>h("schedule"),children:[a("Schedule"),": ",l," "]}),c!=="all"&&g(x,{closable:!0,color:"geekblue",onClose:()=>h("platform"),children:[a("Platform"),": ",c]})]})}const Te="_expandDetails_vflxa_1",ve={expandDetails:Te};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const xe=(e,t,i)=>{e.stopPropagation(),i(t)},{Paragraph:Pe,Text:ke}=J,Fe=(e,t)=>[{dataIndex:"date",key:"date",title:a("Date"),width:"15%"},{dataIndex:"platform",key:"platform",title:a("Platform")},{dataIndex:"account",key:"account",title:a("Account")},{dataIndex:"schedule",key:"schedule",title:a("Schedule"),width:"20%"},{dataIndex:"details",key:"details",render:(c,{details:l,status:r})=>{const h=JSON.stringify(l);return g(K,{align:"center",children:[r==="1"?s(x,{color:"success",children:a("Success")}):s(x,{color:"error",children:a("Error")}),s(Pe,{copyable:{text:h},style:{marginBottom:0},children:h.slice(0,20)})]})},title:a("Response"),width:"20%"},{dataIndex:"actions",key:"actions",render:(c,{details:l,key:r,scheduleId:n,status:h})=>s(j,{children:h==="1"?s(A,{href:l==null?void 0:l.post_url,icon:s(re,{size:13}),size:"small",target:"_blank",children:a("Visit")}):s(A,{danger:!0,disabled:t||!n,icon:s(ce,{size:13}),onClick:f=>xe(f,{details:l,key:r,scheduleId:n},e),size:"small",title:n?a("Retry"):a("Related schedule was deleted"),children:a("Retry")})}),title:a("Actions")}],Le=e=>s(fe,{description:s("pre",{className:ve.expandDetails,children:JSON.stringify(e.details,void 0,2)}),message:e.status==="1"?"Success":"Error",showIcon:!0,type:e.status==="1"?"success":"error"}),De=({expanded:e,onExpand:t,record:i})=>s(A,{onClick:c=>t(i,c),size:"small",children:e?a("Hide"):a("Details")}),je={expandedRowRender:Le,expandIcon:De,expandIconAsCell:!0,expandIconColumnIndex:6};function rt(){const[e,t]=E({}),i=Number(e.get("page"))||1,c=Number(e.get("limit"))||10,[l,r]=v.useState([]),n=Q(R),{isFetching:h,isLogsLoading:f,logData:u,refetch:T,totalLogs:b,totalPages:C}=ye(i,c,n),{deleteLogs:P,isLogsDeleting:w}=be(c,i),{isRetryLoading:k,result:y,retry:M}=Ce(),[D,d]=pe.useMessage();v.useEffect(()=>{if(!k&&(y==null?void 0:y.status)==="success")return D.open({content:"Retry call successfully",type:"success"});if(!k&&(y==null?void 0:y.status)==="error")return D.open({content:"Retry call successfully",type:"success"})},[y]);const F=l.length>0,m=u&&(u==null?void 0:u.map(o=>{var S;return{account:o.details.account_name,date:se(o.created_at,`${N.DATE_FORMAT} ${N.TIME_FORMAT}`),details:o.details,key:o.id,platform:o.platform,schedule:((S=o==null?void 0:o.schedule)==null?void 0:S.name)||`Auto post - Post ID: ${o.details.post_id}`,scheduleId:o.schedule_id,status:o.status}})),_={onSelect:(o,S)=>{if(o){if(S){r(p=>[...p,o.key]);return}r(p=>p.filter(W=>W!==o.key))}},onSelectAll:(o,S)=>{if(o){r(S.map(p=>p==null?void 0:p.key).filter(p=>p!==void 0));return}r([])}},H=async()=>{await P(l),r([])},U=(o,S)=>{t(p=>(p.set("page",String(o)),p.set("limit",String(S)),p))};return v.useEffect(()=>{T(),r([])},[n]),v.useEffect(()=>{!u.length&&C&&i>C&&t(o=>(o.set("page",String(C)),o))},[u,n]),g(j,{children:[g(K,{className:"mb-2",justify:"space-between",children:[g(I,{children:[(f||w)&&s(oe,{}),F?g(j,{children:[s(ke,{children:`Selected ${l.length} items`}),s(de,{description:a("Are you sure to delete this logs?"),okText:a("Confirm"),onConfirm:H,placement:"right",title:a("Delete Logs"),children:s(A,{danger:!0,icon:s(ne,{}),type:"text"})})]}):void 0,Object.values(n).every(o=>o==="all")?void 0:s(Ae,{})]}),g(I,{children:[g(J.Link,{href:"https://bit-social.com/docs/log/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:[a("Visit our documentation"),s(le,{style:{transform:"translateY(-2px)"}})]}),s(A,{icon:s(he,{spin:h}),loading:h,onClick:()=>T(),size:"large",children:a("Refresh")}),s(Se,{})]})]}),s(ie,{}),s(me,{bordered:!0,className:"mt-1",columns:Fe(M,k),dataSource:m,expandable:je,pagination:{current:i,defaultCurrent:1,onChange:U,pageSize:c,showSizeChanger:!0,total:b},rowSelection:_}),d]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{rt as default};
